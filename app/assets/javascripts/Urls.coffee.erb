(->
  window.Url or (window.Url = {})

  Url.update = (base_url) ->
    params = ""
    if $('#bounds').val()    then params += "&bounds=#{$('#bounds').val()}"
    if $('.lodgings-filters .check-in').val()  then params += "&check_in=#{$('.lodgings-filters .check-in').val()}"
    if $('.lodgings-filters .check-out').val() then params += "&check_out=#{$('.lodgings-filters .check-out').val()}"
    if $('#adults').val()    then params += "&adults=#{$('#adults').val()}"
    if $('#children').val()  then params += "&children=#{$('#children').val()}"
    if $('#infants').val()   then params += "&infants=#{$('#infants').val()}"
    if $('#min_price').val() then params += "&min_price=#{$('#min_price').val()}"
    if $('#max_price').val() then params += "&max_price=#{$('#max_price').val()}"
    if $('#order').val()     then params += "&order=#{$('#order').val()}"
    if $('#region').val()    then params += "&region=#{$('#region').val()}"
    if $('#country').val()   then params += "&country=#{$('#country').val()}"
    if $('#discounts').is(':checked') then params += "&discounts=true"
    if $('.realtime-availability').is(':checked') then params += "&realtime_availability=true"
    if $('#layout_view').val() then params += "&layout_view=#{$('#layout_view').val()}"

    for type in $('.lodging-types-list input:checked')
      params += "&lodging_type_in[]=#{$(type).val()}"

    for experience in $('.experiences-list input:checked')
      params += "&experiences_in[]=#{$(experience).val()}"

    for amenity in $('.amenities-list input:checked')
      params += "&amenities_in[]=#{$(amenity).val()}"

    for amenity in $('.amenities-hot-list input:checked')
      params += "&amenities_in[]=#{$(amenity).val()}"

    window.history.pushState(history.state, null, "#{base_url}?#{params}");

).call this
