(->
  window.Url or (window.Url = {})

  Url.update = (base_url) ->
    params = ""
    if $('#bounds').val()    then params += "&bounds=#{$('#bounds').val()}"
    if $('.check-in').val()  then params += "&check_in=#{$('.check-in').val()}"
    if $('.check-out').val() then params += "&check_out=#{$('.check-out').val()}"
    if $('#adults').val()    then params += "&adults=#{$('#adults').val()}"
    if $('#children').val()  then params += "&children=#{$('#children').val()}"
    if $('#infants').val()   then params += "&infants=#{$('#infants').val()}"
    if $('#min_price').val() then params += "&min_price=#{$('#min_price').val()}"
    if $('#max_price').val() then params += "&max_price=#{$('#max_price').val()}"
    if $('#order').val()     then params += "&order=#{$('#order').val()}"
    if $('#region').val()    then params += "&region=#{$('#region').val()}"

    <% Lodging.lodging_types.each do |key, value| %>
    if $("#lodging_type_<%= key %>").is(':checked') then params += "&lodging_type_in[]=#{$('#lodging_type_<%= key %>').val()}"
    <% end %>

    <% Amenity.all.each do |amenity| %>
    if $('#amenity_<%= amenity.slug %>').is(':checked') then params += "&amenities_in[]=#{$('#amenity_<%= amenity.slug %>').val()}"
    <% end %>

    <% Experience.all.each do |experience| %>
    if $('#experience_<%= experience.slug %>').is(':checked') then params += "&experiences_in[]=#{$('#experience_<%= experience.slug %>').val()}"
    <% end %>

    window.history.pushState({}, null, "#{base_url}?#{params}");

).call this
