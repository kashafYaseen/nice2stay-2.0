<%= form_tag lodgings_path, method: :get, class: 'lodgings-filters form-inline', data: { check_in: params[:check_in], check_out: params[:check_out] }, remote: true do %>

  <div class="col-lg-12 col-md-12">
    <div class="sidebar-toggle position-left">
      <i class="material-icons filter_list"></i>
    </div>

    <aside class="sidebar sidebar-offcanvas position-left">
     <span class="sidebar-close"><i class="material-icons icon_close"></i></span>
      <div class="col-md-12">
        <div class="row">       
          <section class="d-none d-sm-block">
            <button class="btn btn-outline-primary dropdown-toggle btn-sm" type="button" id="dropdownMenuButton1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <span class="title"><%= page_entries_info(lodgings, entry_name: 'Lodging' ) %></span>
            </button>
          </section>

          <section>
            <div class="price-dropdown dropdown">
              <button class="btn btn-sm btn btn-outline-primary dropdown-toggle" type="button" id="PriceSortFilter" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class="title"><%= render_sort_text %></span>
              </button>

              <div class="dropdown-menu sorting-dropdown-menu" aria-labelledby="PriceSortFilter">
                <a class="dropdown-item lowest-price" href="#"><%= t 'sorting.low_high' %></a>
                <a class="dropdown-item highest-price" href="#"><%= t 'sorting.high_low' %></a>
                <a class="dropdown-item highest-rating" href="#"><%= t 'sorting.high_rating' %></a>
                <a class="dropdown-item newest" href="#"><%= t 'sorting.new' %></a>
                <a class="dropdown-item default" href="#"><%= t 'sorting.default' %></a>
                <%= hidden_field_tag :order, params[:order] %>
              </div>
            </div>
          </section>

          <section>
            <div id="datepicker"></div>
          </section>

          <section>
            <div class="dropdown guests-dropdown">
              <button class="btn btn-outline-primary dropdown-toggle btn-sm" type="button" id="dropdownMenuButton2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class="title"><%= t('search.guests') %></span>
              </button>

              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton2">
                <div class="dropdown-item">
                  <label><%= t "search.adults" %></label>
                  <%= number_field_tag :adults, params[:adults], min: 0, class: 'adults' %>
                </div>

                <div class="dropdown-item">
                  <label><%= t "search.children" %></label>
                  <%= number_field_tag :children, params[:children], min: 0, class: 'children' %>
                </div>

                <div class="dropdown-item">
                  <label><%= t "search.babies" %></label>
                  <%= number_field_tag :infants, params[:infants], min: 0, class: 'infants' %>
                </div>

                <div class="dropdown-item">
                  <%= submit_tag 'Done', class: 'btn btn-sm btn-secondary submit-filters float-right' %>
                </div>
              </div>
            </div>
          </section>

          <section class="lodging-types-list">
            <div class="dropdown guests-dropdown">
              <button class="btn btn-outline-primary dropdown-toggle btn-sm" type="button" id="dropdownMenuButton3" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class="title">Type</span>
              </button>

              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton3">
                <div class="dropdown-item">
                  <p class="widget-title"><%= t 'filters.type' %></p>
                  <% Lodging.lodging_types.each do |key, value| %>
                    <div class="custom-control custom-checkbox">
                      <%= check_box_tag "lodging_type_in[]", key, is_checked?(key, :lodging_type_in), id: "lodging_type_#{key}", class: "custom-control-input lodging_type" %>

                      <label class="custom-control-label" for="lodging_type_<%= key %>">
                        <%= t("filters.#{key}") %>&nbsp; <span class="text-muted">(<%= render_lodgings_count_for(lodgings, key, 'lodging_type') %>)</span>
                      </label>
                    </div>
                  <% end %>
              </div>
            </div>
          </section>

          <section>
            <div class="dropdown guests-dropdown">
              <button class="btn btn-outline-primary dropdown-toggle btn-sm" type="button" id="dropdownMenuButton4" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class="title"><%= t('search.price') %></span>
              </button>

              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton4">
                <div class="dropdown-item">
                  <p class="widget-title"><%= t 'filters.price' %></p>
                  <div class="price-range-slider p-1" data-start-min="<%= render_min_price params[:min_price] %>" data-start-max="<%= render_max_price params[:max_price] %>" data-min="0" data-max="1500" data-step="1">
                    <div class="ui-range-slider"></div>
                    <footer class="ui-range-slider-footer pt-3">
                      <div class="column">
                        <div class="ui-range-values">
                          <div class="ui-range-value-min">€<span></span>
                            <%= hidden_field_tag :min_price, render_min_price(params[:min_price]) %>
                          </div>&nbsp;-&nbsp;

                          <div class="ui-range-value-max">€<span></span>
                            <%= hidden_field_tag :max_price, render_max_price(params[:max_price]) %>
                          </div>
                        </div>
                      </div>
                    </footer>
                  </div>
                </div>

                <div class="dropdown-item">
                  <div class="custom-control custom-checkbox">
                    <%= check_box_tag :discounts, true, params[:discounts], class: "custom-control-input discounts" %>
                    <%= label_tag :discounts, t('search.special_offer'), class: 'text-xxxs custom-control-label' %>
                      &nbsp; <span class="text-muted">(<%= render_lodgings_count_for(lodgings, 1, 'discounts') %>)</span>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <button class="btn btn-outline-primary btn-sm more-filters-btn" type="button" data-toggle="modal" data-title="<%= t('filters.more_filters') %>">
            <%= t('filters.more_filters') %>
          </button>
        </div>
      </div>
    </aside>
  </div>

  <div class="modal fade" id="more-filters" tabindex="-1" role="dialog" style="z-index: 100">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-body p-5">
          <section class="experiences-list row mb-4">
            <p class="widget-title"><%= t('search.updated_availability') %></h3>

            <div class="custom-control custom-checkbox col-md-12">
              <%= check_box_tag :checked, true, params[:checked], class: "custom-control-input amenities" %>
              <%= label_tag :checked, t('search.updated_availability'), class: 'text-xxxs custom-control-label' %>
              &nbsp; <span class="text-muted">(<%= render_lodgings_count_for(lodgings, 1, 'checked') %>)</span>
            </div>
          </section>

          <section class="row experiences-list">
            <p class="p-0 col-md-12"><%= t 'filters.theme' %> </p>
            <% experiences.each do |experience| %>
              <div class="custom-control custom-checkbox col-md-6">
                <%= check_box_tag "experiences_in[]", experience.slug, is_checked?(experience.slug, :experiences_in), id: "experience_#{experience.id}", class: "custom-control-input experiences" %>

                <label class="custom-control-label" for="experience_<%= experience.id %>">
                  <%= experience.name %>&nbsp; <span class="text-muted">(<%= render_lodgings_count_for(lodgings, experience.id, 'experiences') %>)</span>
                </label>
              </div>
            <% end %>
          </section>

          <section class="row pt-5 amenities-list">
            <p class="p-0 col-md-12"><%= t 'filters.amentities' %></p>
            <% amenities.hot.each do |amenity| %>
              <div class="custom-control custom-checkbox col-md-6">
                <%= check_box_tag "amenities_in[]", amenity.name, is_checked?(amenity.name, :amenities_in), id: "amenity_#{amenity.id}", class: "custom-control-input amenities" %>

                <label class="custom-control-label" for="amenity_<%= amenity.id %>">
                  <%= amenity.name %>&nbsp; <span class="text-muted">(<%= render_lodgings_count_for(lodgings, amenity.id, 'amenities') %>)</span>
                </label>
              </div>
            <% end %>

            <% amenities.regular.each do |amenity| %>
              <div class="custom-control custom-checkbox col-md-6">
                <%= check_box_tag "amenities_in[]", amenity.name, is_checked?(amenity.name, :amenities_in), id: "amenity_#{amenity.id}", class: "custom-control-input amenities" %>

                <label class="custom-control-label" for="amenity_<%= amenity.id %>">
                  <%= amenity.name %>&nbsp; <span class="text-muted">(<%= render_lodgings_count_for(lodgings, amenity.id, 'amenities') %>)</span>
                </label>
              </div>
            <% end %>
          </section>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-sm btn-secondary" data-dismiss="modal">Cancel</button>
          <button class="btn btn-white btn-sm submit-filters" type="button">Apply</button>
        </div>
      </div>
    </div>
  </div>

  <%= hidden_field_tag :region, params[:region] unless params[:bounds].present? %>
  <%= hidden_field_tag :country, params[:country] unless params[:bounds].present? %>
  <%= hidden_field_tag :bounds, params[:bounds] %>
<% end %>