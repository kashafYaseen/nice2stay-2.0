<%= form_for @reservation, url: rates_lodging_guest_centric_offers_en_path(lodging), remote: true, html: { id: "new_reservation_#{lodging.id}#{child['id_offer']}" } do |f| %>

  <% offers = [] %>
  <div class="row mt-3 children-scroll-section">
    <div class="col-md-2 col-border bg-white">
      <% if child['isPromotion'] %>
        <% if child['type'] == 'percentage' %>
          <span class="text-info"><%= child['percentage'] %>% off</span>
        <% else %>
          <span class="text-info">€<%= child['promotionValue'] %> off</span>
        <% end %>
      <% end %>

      <%= image_tag child['defaultImage'], class: 'w-100 max-height-230' if child['defaultImage'].present? %>
    </div>

    <div class="col-md-4 col-border bg-white text-sm">
      <b><%= child['name'] %></b>
      <p><%= child['description'].try(:html_safe) %></p>

      <% if child['restrictions'].present? %>
        Restrictions:

        <ul class="text-xxs">
          <%= child['restrictions'].html_safe %>
        </ul>
      <% end %>
    </div>

    <div class="col-md-4 col-border bg-white text-sm group-toggle">
      <% if child['isPromotion'] %>
        <% child['offers'].each do |offer| %>
          <%= render 'guest_centric_offers/modal', child: offer, meal_plans: child['mealPlans'], reservation: @reservation, lodging: @lodging %>

          <% offers << offer['offer'].gsub('.', '-') %>
          <label class="col-border col-md-12 border-dark border-right" data-submit="#new_reservation_<%= "#{lodging.id}#{child['id_offer']}" %>" data-bookable="<%= child["isBookable"] %> " data-price="<%= offer['total'] %>">
            <%= link_to "#{offer['name'].try(:capitalize)} - more details", '#', data: { target: "#offers-modal-#{offer['offer'].gsub('.', '-')}", toggle: 'modal' }, class: 'text-bold text-xlg guest-centric-modal-btn' %><br>

            <%= f.radio_button(:offer_id, offer['offer'], class: "offers-select-radio") %>
            <span>
              <%= "Adults: #{offer['MaxAdults']} - Children: #{offer['MaxChildren']}" %>
            </span>

            <span class="float-right">
              <%= "€#{offer['total']}" %>
            </span>

          <% if child['mealPlans'].present? && child['mealPlans'].count > 1 %>
            <b class="mt-3 d-block">options</b>
          <% end %>

          <% child['mealPlans'].each do |meal| %>
            <% next if meal['id'] == 1 %>
            <div class="row">
              <span class="col-md-8 text-left">
                <%= f.check_box :meal_id, { class: 'meal_check_box', data: { price: meal['total'] } }, meal['id'], nil %>
                <b><%= meal['label'] %></b>
              </span>

              <span class="col-md-4 text-right">
                <b><%= "€#{meal['total']}" %></b>
              </span>
            </div>
          <% end if child['mealPlans'].present? %>

          </label><br>
        <% end %>
      <% else %>
        <% offers << child['offer'].gsub('.', '-') %>
        <%= render 'guest_centric_offers/modal', child: child, meal_plans: child['mealPlans'], reservation: @reservation, lodging: @lodging %>

        <label class="col-border col-md-12 border-dark border-right" data-submit="#new_reservation_<%= "#{lodging.id}#{child['id_offer']}" %>" data-bookable="<%= child["isBookable"] %>" data-price="<%= child['total'] %>">
          <%= link_to "#{child['name'].try(:capitalize)} - more details", '#', data: { target: "#offers-modal-#{child['offer'].gsub('.', '-')}", toggle: 'modal' }, class: 'text-bold text-xlg guest-centric-modal-btn' %><br>

          <%= f.radio_button(:offer_id, child['offer'], class: "offers-select-radio") %>

          <span>
            <%= "Adults: #{child['MaxAdults']} - Children: #{child['MaxChildren']}" %>
          </span>

          <span class="float-right"><%= "€#{child['total']}" %></span>

          <% if child['mealPlans'].present? && child['mealPlans'].count > 1 %>
            <b class="mt-3 d-block">options</b>
          <% end %>

          <% child['mealPlans'].each do |meal| %>
            <% next if meal['id'] == 1 %>
            <div class="row">
              <span class="col-md-8 text-left">
                <%= f.check_box :meal_id, { class: 'meal_check_box', data: { price: meal['total'] } }, meal['id'], nil %>
                <b><%= meal['label'] %></b>
              </span>

              <span class="col-md-4 text-right">
                <b><%= "€#{meal['total']}" %></b>
              </span>
            </div>
          <% end if child['mealPlans'].present? %>
        </label>
      <% end %>
    </div>

    <div class="col-md-2 bg-white col-border">
        <p class="<%= offers.join(' ') %> text-center text-bold mb-0"></p>
        <%= button_tag class: "btn btn-primary col-md-12 btn-booking disabled", id: "cart-#{lodging.id}", data: { form_id: "#new_reservation_#{lodging.id}#{child['id_offer']}" }, value: "cart" do %>
          <i class="material-icons add_shopping_cart"></i>&nbsp; Cart
        <% end %>

      <p class="text-xxxs text-center"><b><%= "#{child['cancelPolicy']['type']}: #{child['cancelPolicy']['name']}" %></b></p>
      <p class="text-xxxs text-center"><%= t 'cart.nice2stay' %></p>
    </div>
  </div>

  <%= f.hidden_field :check_in, value: get_centric_param(:check_in), id: "check_in_#{lodging.id}", class: 'check_in' %>
  <%= f.hidden_field :check_out, value: get_centric_param(:check_out), id: "check_out_#{lodging.id}", class: 'check_out' %>
  <%= f.hidden_field :adults, value: no_of_adults(get_centric_param(:adults) || f.object.adults), id: "adults_#{lodging.id}", class: 'adults' %>
  <%= f.hidden_field :children, value: (get_centric_param(:children) || f.object.children), id: "children_#{lodging.id}", class: 'children' %>
  <%= f.hidden_field :infants, value: (get_centric_param(:infants) || f.object.infants), id: "infants_#{lodging.id}", class: 'infants' %>
  <%= f.hidden_field :lodging_id, value: lodging.id, id: "lodging_id_#{lodging.id}" %>
  <%= f.hidden_field :offer_id, class: 'offer-id' %>
  <%= f.hidden_field :meal_price, class: 'meal-price' %>
  <%= hidden_field_tag :target_modal %>
<% end %>
